# ppauth
Generic authentication endpoint for post-platforms.

Before a user can interact with a platform in w3ds
she needs to provide the platform with her ename.
Obviously, the platform will not just take her word for it:
the ename needs to be signed with the private key
hidden behind eid app in user's mobile phone.
The platform can dereference a `/whois` endpoint for this ename
using any registry to obtain the public key bound to this ename
in the evault and bound cryptographically to the private key on the phone.

In our prototype every post-platform had a copy of such code.
This is a python Flask http server that become auth-aaS via 3 routes:
* /login/<platform>
* /ppauth
* /ename/<session id>

### Login
Given a name of a platform produces a QR code for eid app(s).
The QR will include a URL of the form:
`w3ds://auth?redirect={base}/ppauth&session={ssn}&platform={platform}"`
where `base` is where this is deployed; `ssn` is unique session id
generated by login code.

### Ename
This route can be used with normal "fetch" request or with `EventSource`,
since it produces an SSE stream. This allows the caller of `/ename`
to gracefully wait for the authentication to complete.

### Auth
eid app on the phone reacting to scanned QR code provides a proof of ename.
This allows the original blocked login request/stream to finish.
Note: the authentication request will often come from a different device:
when we use a platform on a desktop computer's browser, this request
will be performed by eid app on the mobile phone.
This also means that if you run the server in single worker and single thread
mode, eid app will wait until timeout when sending jwt to `ppauth`.

## TODO
* this implementation is not the most resilient, the goal was to:
1. provide an educational example (in python as opposed to TS)
2. create an easy to deploy auth endpoint to be used in toy platforms
* same for security 


