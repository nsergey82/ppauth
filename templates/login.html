<html>

<head>
    <title>Login</title>
</head>

<body>
    <h3>Authenticate with the platform "{{platform}}" using your eid app</h3>
    {{qr | safe }}
    <script>
        const session = '{{session}}';
        console.log(session);
        // if you wish to block on fetch use /ename/<session> endpoint instead
        const evtSource = new EventSource('/ename_s/' + session);
        evtSource.onmessage = (e) => {
            const ename = e.data;
            console.log("Authenticated ename " + ename);
            alert("You have been authenticated as " + ename);
            evtSource.close();
        };
        evtSource.onerror = (e) => {
            alert("Failed to fetch an ename");
            evtSource.close();
        };

    </script>
</body>

</html>